<!DOCTYPE html>
<html>
<head>
	<title>Als Naturdenkmale geschützte Findlinge & Bäume in Charlottenburg-Wilmersdorf | goYippi labs</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

	<style>
		@font-face {
			font-family: 'Source Sans Pro';
			font-style: normal;
			font-weight: 400;
			src: url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.eot'); /* IE9 Compat Modes */
			src: local('Source Sans Pro Regular'), local('SourceSansPro-Regular'),
					 url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
					 url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.woff2') format('woff2'), /* Super Modern Browsers */
					 url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.woff') format('woff'), /* Modern Browsers */
					 url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.ttf') format('truetype'), /* Safari, Android, iOS */
					 url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-regular.svg#SourceSansPro') format('svg'); /* Legacy iOS */
		}
		@font-face {
		  font-family: 'Source Sans Pro';
		  font-style: normal;
		  font-weight: 700;
		  src: url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-700.eot'); /* IE9 Compat Modes */
		  src: local('Source Sans Pro Bold'), local('SourceSansPro-Bold'),
		       url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-700.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
		       url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-700.woff2') format('woff2'), /* Super Modern Browsers */
		       url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-700.woff') format('woff'), /* Modern Browsers */
		       url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-700.ttf') format('truetype'), /* Safari, Android, iOS */
		       url('https://www.goyippi.net/wp-content/themes/goyippi/fonts/source-sans-pro/source-sans-pro-v11-latin-ext_latin-700.svg#SourceSansPro') format('svg'); /* Legacy iOS */
		}
		html, body {
			height: 100%;
			margin: 0;
		}
		body, .leaflet-container {
			font-family: 'Source Sans Pro', Arial, sans-serif;
			font-size: 0.875em;
			line-height: 1.5;
		}
		header {
			height: 15%;
			height: 15vh;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		h1 {
			padding: 10px 15px;
			font-size: 20px;
		}
		#map {
			width: 100%;
			height: 85%;
			height: 85vh;
		}
		.layer_icon {
			display:inline-block;
			background-color:#7B7B7B;
			width:12px;
			height:12px;
			vertical-align:middle;
		}
		.layer_icon_tree {
			background-color:#2AAD27
		}
		.embedded header {
			display: none;
		}
		.embedded #map {
			height: 100%;
			height: 100vh;
		}
		.leaflet-popup-content img {
			display: none;
			max-width: 100%;
		}
		@media screen and (min-width: 600px) {
			header {
				height: 10%;
				height: 10vh;
			}
			#map {
				height: 90%;
				height: 90vh;
			}
			.embedded #map {
				height: 100%;
				height: 100vh;
			}
		}
		@media screen and (min-height: 720px) {
			.leaflet-popup-content img {
				display: block;
			}
		}
	</style>
</head>

<body>
	<header>
		<h1>Als Naturdenkmale geschützte Findlinge & Bäume in Charlottenburg-Wilmersdorf</h1>
	</header>
	<div id='map'></div>

	<script>
		const queryString = window.location.search;
		const urlParams = new URLSearchParams(queryString);
		const embedded = urlParams.get('embedded');

		if (embedded == 'true') {
			var body = document.body;
			body.classList.add('embedded');
		}

		var getJSON = function(url, callback) {
		  var xhr = new XMLHttpRequest();
		  xhr.open('GET', url, true);
		  xhr.responseType = 'json';
		  xhr.onload = function() {
		    var status = xhr.status;
		    if (status === 200) {
		      callback(null, xhr.response);
		    } else {
		      callback(status, xhr.response);
		    }
		  };
		  xhr.send();
		};

		var onEachBoulderFeature = function(feature, layer) {
			var popupContent = '';
			if (feature.properties && feature.properties.data.standort) {
				popupContent += '<p><strong>' + feature.properties.data.standort + '</strong></p>';
			}

			popupContent += '<p>';
			if (feature.properties && feature.properties.data.adresse) {
				popupContent += 'Adresse: ' + feature.properties.data.adresse + '<br />';
			}
			if (feature.properties && feature.properties.data.abmasse) {
				popupContent += 'Abmaße: ' + feature.properties.data.abmasse + '<br />';
			}
			popupContent += '</p>';
			popupContent += '<p>';
			if (feature.properties && feature.properties.data.nr_senstadtum) {
				popupContent += 'Nummer SenStadtUm: ' + feature.properties.data.nr_senstadtum + '<br />';
			}
			if (feature.properties && feature.properties.href) {
				popupContent += 'Link: <a href="https://berlin.de' + feature.properties.href +'" target="_blank">Eintrag beim Bezirksamt</a>';
			}
			popupContent += '</p>';

			if (feature.properties && feature.properties.data.original_bild) {
				var image_url = feature.properties.data.original_bild.replace('"Foto":','');
				image_url = image_url.replace('http:','https:');
				popupContent += '<img src="' + image_url + '" width="300" />';
			}

			layer.bindPopup(popupContent).addTo(boulders);
		}

		var onEachTreeFeature = function(feature, layer) {
			var popupContent = '';

			popupContent += '<p>';
			if (feature.properties && feature.properties.data.dt_name) {
				popupContent += '<strong>' + feature.properties.data.dt_name + '</strong><br />';
			}
			if (feature.properties && feature.properties.data.wiss_name) {
				popupContent += feature.properties.data.wiss_name + '<br />';
			}
			popupContent += '</p>';

			popupContent += '<p>';
			if (feature.properties && feature.properties.data.standort) {
				popupContent += 'Standort: ' + feature.properties.data.standort + '<br />';
			}
			if (feature.properties && feature.properties.data.adresse) {
				popupContent += 'Adresse: ' + feature.properties.data.adresse + '<br />';
			}
			if (feature.properties && feature.properties.data.stamm_umfang) {
				popupContent += 'Stammumfang: ' + feature.properties.data.stamm_umfang + '<br />';
			}
			if (feature.properties && feature.properties.data.schutzzweck) {
				popupContent += 'Schutzzweck: ' + feature.properties.data.schutzzweck + '<br />';
			}
			popupContent += '</p>';
			popupContent += '<p>';
			if (feature.properties && feature.properties.data.baumnr) {
				popupContent += 'Baumnummer: ' + feature.properties.data.baumnr + '<br />';
			}
			if (feature.properties && feature.properties.data.nr_senstadtum) {
				popupContent += 'Nummer SenStadtUm: ' + feature.properties.data.nr_senstadtum + '<br />';
			}
			if (feature.properties && feature.properties.href) {
				popupContent += 'Link: <a href="https://berlin.de' + feature.properties.href +'" target="_blank">Eintrag beim Bezirksamt</a>';
			}
			popupContent += '</p>';

			if (feature.properties && feature.properties.data.original_bild) {
				var image_url = feature.properties.data.original_bild.replace('"Foto":','');
				image_url = image_url.replace('http:','https:');
				popupContent += '<img src="' + image_url + '" width="300" />';
			}

			layer.bindPopup(popupContent).addTo(trees);
		}

		var greyIcon = new L.Icon({
		  iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png',
		  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
		  iconSize: [25, 41],
		  iconAnchor: [12, 41],
		  popupAnchor: [1, -34],
		  shadowSize: [41, 41]
		});

		var greenIcon = new L.Icon({
		  iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
		  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
		  iconSize: [25, 41],
		  iconAnchor: [12, 41],
		  popupAnchor: [1, -34],
		  shadowSize: [41, 41]
		});

		var boulders = L.layerGroup();
		var trees = L.layerGroup();

		var map = L.map('map', {
			center: [52.5080245, 13.2688927],
			zoom: 12,
			layers: [boulders, trees]
		});

		L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
			attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ | Data <a href="https://creativecommons.org/licenses/by/3.0/de/" target="_blank">CC-BY</a> <a href="https://daten.berlin.de/datensaetze?field_publisher_tid=719" target="_blank">Bezirksamt Charlottenburg-Wilmersdorf von Berlin, Umwelt- und Naturschutzamt</a>',
			maxZoom: 16
		}).addTo(map);

		getJSON('https://www.berlin.de/ba-charlottenburg-wilmersdorf/verwaltung/aemter/umwelt-und-naturschutzamt/naturschutz/findlinge/index.php/index/all.gjson?q=',
		function(err, boulder) {
		  if (err !== null) {
		    //alert('Something went wrong: ' + err);
		  } else {
				L.geoJSON(boulder, {
					pointToLayer: function(feature, latlng) {
						return L.marker(latlng, { icon:greyIcon });
					},
					onEachFeature: onEachBoulderFeature
				}).addTo(map);
			}
		});

		getJSON('https://www.berlin.de/ba-charlottenburg-wilmersdorf/verwaltung/aemter/umwelt-und-naturschutzamt/naturschutz/baeume/index.php/index/all.gjson?q=',
		function(err, tree) {
		  if (err !== null) {
		    //alert('Something went wrong: ' + err);
		  } else {
				L.geoJSON(tree, {
					pointToLayer: function(feature, latlng) {
		        return L.marker(latlng, { icon:greenIcon });
		      },
					onEachFeature: onEachTreeFeature
				}).addTo(map);
			}
		});

		var baseLayers = {};

		var overlays = {
			'<span class="layer_icon layer_icon_boulder"></span> Findlinge': boulders,
			'<span class="layer_icon layer_icon_tree"></span> Bäume': trees
		};

		L.control.layers(baseLayers,overlays).addTo(map);
	</script>
</body>
</html>
